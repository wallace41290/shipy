<shipy-search-filters
  [endDate]="endDate"
  [numberOfNights]="selectedNumNights"
  [ports]="selectedPorts"
  [ships]="selectedShips"
  [startDate]="startDate"
  (endDateChange)="endDateChanged($event)"
  (numberOfNightsChange)="updateNumberOfNights($event)"
  (portsChange)="updatePort($event)"
  (shipsChange)="updateShips($event)"
  (startDateChange)="startDateChanged($event)"
></shipy-search-filters>

<ng-container *ngIf="searchResponse$ | async as searchResponse">
  <table
    mat-table
    [dataSource]="searchResponse?.data?.cruiseSearch?.results?.cruises || []"
    class="mat-elevation-z8"
  >
    <ng-container matColumnDef="ship">
      <th mat-header-cell *matHeaderCellDef>Ship</th>
      <td mat-cell *matCellDef="let cruise">
        {{ cruise.masterSailing.itinerary.ship.name }}
      </td>
    </ng-container>

    <ng-container matColumnDef="numNights">
      <th mat-header-cell *matHeaderCellDef># Nights</th>
      <td mat-cell *matCellDef="let cruise">
        {{ cruise.masterSailing.itinerary.sailingNights }}
      </td>
    </ng-container>

    <ng-container matColumnDef="sailDate">
      <th mat-header-cell *matHeaderCellDef>Sail Date</th>
      <td mat-cell *matCellDef="let cruise">
        {{ cruise.lowestPriceSailing.sailDate }}
      </td>
    </ng-container>

    <ng-container matColumnDef="stateroom">
      <th mat-header-cell *matHeaderCellDef>Stateroom</th>
      <td mat-cell *matCellDef="let cruise">
        {{
          cruise.lowestPriceSailing.lowestStateroomClassPrice.stateroomClass.id
        }}
      </td>
    </ng-container>

    <ng-container matColumnDef="avgPrice">
      <th mat-header-cell *matHeaderCellDef>Avg. Price Per Person</th>
      <td mat-cell *matCellDef="let cruise">
        ${{ cruise.lowestPriceSailing.lowestStateroomClassPrice.price.value }}
      </td>
    </ng-container>

    <ng-container matColumnDef="taxes">
      <th mat-header-cell *matHeaderCellDef>Taxes</th>
      <td mat-cell *matCellDef="let cruise">
        ${{ cruise.lowestPriceSailing.taxesAndFees.value }}
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
  <mat-paginator
    aria-label="Select page"
    showFirstLastButtons
    [length]="searchResponse?.data?.cruiseSearch?.results?.total"
    [pageIndex]="pageIndex"
    [pageSize]="pageSize"
    [pageSizeOptions]="[5, 10, 25, 100]"
    (page)="handlePageChange($event)"
  >
  </mat-paginator>
</ng-container>
